# MySQL 数据库互导程序 - 使用说明

## 🚀 快速开始

### 1. 环境准备
- Python 3.10+
- MySQL 5.7+ / 8.0+
- 网络连接（用于下载依赖包）

### 2. 安装依赖
```bash
# Windows
pip install -r requirements.txt

# Linux/Mac
pip3 install -r requirements.txt
```

### 3. 配置数据库
编辑 `config.py` 文件，修改数据库连接信息：

```python
# 源数据库配置
SOURCE_DB = {
    'host': 'localhost',        # 数据库主机
    'port': 3306,              # 端口
    'user': 'root',            # 用户名
    'password': 'your_password', # 密码
    'database': 'source_db',   # 数据库名
    'charset': 'utf8mb4'
}

# 目标数据库配置
TARGET_DB = {
    'host': 'localhost',
    'port': 3306,
    'user': 'root',
    'password': 'your_password',
    'database': 'target_db',
    'charset': 'utf8mb4'
}
```

### 4. 启动程序
```bash
# Windows
start.bat

# Linux/Mac
chmod +x start.sh
./start.sh

# 或直接运行
python app.py
```

### 5. 访问界面
打开浏览器访问：http://localhost:5000

## 📋 功能模块

### 🏠 主页面功能
1. **数据库表选择** - 动态加载源数据库和目标数据库的表列表
2. **字段映射** - 可视化字段映射界面，支持手动映射和默认值设置
3. **数据预览** - 预览源表数据，确认数据格式和内容
4. **导入模式选择** - 覆盖模式或仅新增模式
5. **实时进度监控** - 显示导入进度百分比和详细日志
6. **数据备份** - 在导入前备份目标表数据

### ⚙️ 配置管理
- **数据库连接配置** - 可视化配置源数据库和目标数据库连接
- **连接测试** - 实时测试数据库连接状态
- **系统参数设置** - 分页大小、日志文件等配置
- **配置保存与重置** - 配置的持久化存储

### 📊 导入历史
- **历史记录查看** - 查看所有导入任务的详细记录
- **状态跟踪** - 成功/失败状态、记录数、耗时统计
- **字段映射查看** - 查看历史导入的字段映射配置
- **历史管理** - 清空历史记录功能

## 📋 使用步骤

### 步骤1：选择数据表
1. 点击"刷新"按钮加载源数据库和目标数据库的表列表
2. 分别选择源表和目标表

### 步骤2：预览数据（可选）
1. 点击"预览数据"按钮查看源表的前10条记录
2. 确认数据格式和内容是否符合预期

### 步骤3：字段映射
1. 点击"加载字段映射"按钮
2. 系统会显示目标表的所有字段
3. 为每个目标字段选择对应的源字段
4. 对于没有对应源字段的目标字段，可以设置默认值

### 步骤4：选择导入模式
- **覆盖模式**：使用 `REPLACE INTO`，会覆盖目标表中的重复数据
- **仅新增模式**：使用 `INSERT IGNORE`，只插入新数据，不覆盖已有数据

### 步骤5：数据备份（推荐）
1. 点击"备份数据"按钮
2. 系统会创建目标表的完整备份
3. 备份表名可自定义或自动生成

### 步骤6：开始导入
1. 点击"开始导入"按钮
2. 系统会在后台执行导入任务
3. 右侧日志区域会实时显示导入进度
4. 导入完成后会显示完成信息

## 🔧 高级功能

### 数据预览
- 支持预览源表的前10条记录
- 自动截断长文本内容，鼠标悬停查看完整内容
- 显示字段名和数据类型信息

### 进度监控
- 实时显示导入进度百分比
- 显示已导入记录数和总记录数
- 详细的日志信息，包括每页导入状态

### 数据备份
- 支持在导入前自动备份目标表
- 备份表包含完整的数据和结构
- 支持自定义备份表名或自动生成

### 导入历史
- 记录所有导入任务的详细信息
- 包括时间、表名、模式、状态、记录数、耗时等
- 支持查看历史字段映射配置

### 配置管理
- 可视化数据库连接配置
- 实时连接测试功能
- 系统参数在线调整
- 配置的持久化存储

## ⚙️ 配置说明

### 分页设置
在 `config.py` 中可以调整分页大小：
```python
PAGE_SIZE = 100  # 每页导入的记录数，可根据服务器性能调整
```

### 日志文件
导入日志会保存在 `logs/import.log` 文件中，可以查看详细的导入过程。

### 历史记录
导入历史会保存在 `logs/import_history.json` 文件中，最多保留50条记录。

## 🔧 故障排除

### 常见问题

1. **数据库连接失败**
   - 检查数据库配置信息是否正确
   - 确认数据库服务是否启动
   - 检查网络连接和防火墙设置
   - 使用配置管理页面的连接测试功能

2. **表或字段不存在**
   - 确认选择的表名正确
   - 检查数据库权限
   - 使用数据预览功能确认表结构

3. **导入失败**
   - 查看日志文件了解具体错误信息
   - 检查字段映射是否正确
   - 确认目标表结构是否兼容
   - 检查数据类型是否匹配

4. **页面无法访问**
   - 确认 Flask 应用是否正常启动
   - 检查端口 5000 是否被占用
   - 尝试访问 http://127.0.0.1:5000

5. **备份失败**
   - 检查目标数据库的 CREATE TABLE 权限
   - 确认备份表名不重复
   - 检查磁盘空间是否充足

### 性能优化

1. **大表导入**
   - 适当调整 `PAGE_SIZE` 参数
   - 在非业务高峰期进行导入
   - 确保目标数据库有足够的存储空间
   - 考虑使用数据备份功能

2. **网络优化**
   - 如果源数据库和目标数据库在不同服务器，确保网络连接稳定
   - 考虑使用数据库的批量导入工具进行大量数据迁移

3. **内存优化**
   - 根据服务器内存调整分页大小
   - 避免同时进行多个导入任务

## 📝 注意事项

1. **数据安全**
   - 导入前建议使用备份功能备份目标表
   - 在生产环境使用前先在测试环境验证
   - 定期清理不需要的备份表

2. **权限要求**
   - 源数据库需要 SELECT 权限
   - 目标数据库需要 INSERT/REPLACE/CREATE TABLE 权限

3. **数据类型**
   - 确保字段映射的数据类型兼容
   - 注意字符集和排序规则的一致性
   - 使用数据预览功能确认数据格式

4. **备份管理**
   - 定期清理旧的备份表
   - 备份表会占用数据库存储空间
   - 建议为备份表建立命名规范

## 🆘 技术支持

如果遇到问题，请检查：
1. Python 和 MySQL 版本是否符合要求
2. 依赖包是否正确安装
3. 数据库连接配置是否正确
4. 查看日志文件中的错误信息
5. 使用配置管理页面的连接测试功能
6. 检查导入历史记录了解失败原因

---

**版本**: 2.0.0  
**更新时间**: 2024年  
**新增功能**: 数据预览、进度监控、配置管理、导入历史、数据备份
