<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>按钮测试页面</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>按钮功能测试</h2>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>测试按钮</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary" id="testBtn1">测试按钮1</button>
                        <button class="btn btn-success" id="testBtn2">测试按钮2</button>
                        <button class="btn btn-warning" id="testBtn3">测试按钮3</button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>调试信息</h5>
                    </div>
                    <div class="card-body">
                        <div id="debugOutput" style="height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; font-family: monospace;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>数据库表选择测试</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">源数据库表</label>
                                <select class="form-select" id="sourceTable">
                                    <option value="">请选择源表...</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">目标数据库表</label>
                                <select class="form-select" id="targetTable">
                                    <option value="">请选择目标表...</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-primary" id="loadFields" disabled>
                                <i class="fas fa-link"></i> 加载字段映射
                            </button>
                            <button class="btn btn-info" id="previewData" disabled>
                                <i class="fas fa-eye"></i> 预览数据
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        function log(message) {
            const debugDiv = document.getElementById('debugOutput');
            const timestamp = new Date().toLocaleTimeString();
            debugDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            debugDiv.scrollTop = debugDiv.scrollHeight;
            console.log(message);
        }

        // 测试按钮事件
        document.getElementById('testBtn1').addEventListener('click', () => {
            log('测试按钮1被点击');
        });

        document.getElementById('testBtn2').addEventListener('click', () => {
            log('测试按钮2被点击');
        });

        document.getElementById('testBtn3').addEventListener('click', () => {
            log('测试按钮3被点击');
        });

        // 加载数据库表
        async function loadTables(dbType) {
            try {
                log(`开始加载${dbType}数据库表...`);
                const response = await axios.post('/get_tables', {
                    db_type: dbType
                });

                if (response.data.success) {
                    const selectId = dbType === 'source' ? 'sourceTable' : 'targetTable';
                    const select = document.getElementById(selectId);
                    
                    select.innerHTML = '<option value="">请选择表...</option>';
                    
                    response.data.tables.forEach(table => {
                        const option = document.createElement('option');
                        option.value = table;
                        option.textContent = table;
                        select.appendChild(option);
                    });

                    log(`${dbType}数据库表加载成功 (${response.data.tables.length}个表)`);
                    checkFieldsButton();
                } else {
                    log(`${dbType}数据库表加载失败: ${response.data.message}`);
                }
            } catch (error) {
                log(`加载${dbType}数据库表失败: ${error.message}`);
            }
        }

        // 检查字段按钮状态
        function checkFieldsButton() {
            const sourceTable = document.getElementById('sourceTable').value;
            const targetTable = document.getElementById('targetTable').value;
            const loadFieldsBtn = document.getElementById('loadFields');
            const previewDataBtn = document.getElementById('previewData');
            
            log(`检查按钮状态: sourceTable=${sourceTable}, targetTable=${targetTable}`);
            
            if (loadFieldsBtn) {
                loadFieldsBtn.disabled = !(sourceTable && targetTable);
                log(`loadFields按钮状态: ${loadFieldsBtn.disabled ? '禁用' : '启用'}`);
            }
            if (previewDataBtn) {
                previewDataBtn.disabled = !sourceTable;
                log(`previewData按钮状态: ${previewDataBtn.disabled ? '禁用' : '启用'}`);
            }
        }

        // 字段按钮事件
        document.getElementById('loadFields').addEventListener('click', () => {
            log('加载字段映射按钮被点击');
        });

        document.getElementById('previewData').addEventListener('click', () => {
            log('预览数据按钮被点击');
        });

        // 表选择变化
        document.getElementById('sourceTable').addEventListener('change', () => {
            log('源表选择变化');
            checkFieldsButton();
        });

        document.getElementById('targetTable').addEventListener('change', () => {
            log('目标表选择变化');
            checkFieldsButton();
        });

        // 页面加载完成后开始测试
        document.addEventListener('DOMContentLoaded', function() {
            log('页面加载完成，开始测试');
            
            // 延迟加载表列表
            setTimeout(() => {
                loadTables('source');
            }, 500);
            
            setTimeout(() => {
                loadTables('target');
            }, 1000);
        });
    </script>
</body>
</html>

