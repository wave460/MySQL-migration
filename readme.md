好的，我来给你做一个完整的 **MySQL 数据库互导程序**的功能架构总结，包括功能说明、技术栈、应用场景以及运行机制等。这样你可以清楚理解整个系统。

---

# MySQL 数据库互导程序 - 功能与架构总结

## 1️⃣ 系统概述

这是一个基于 **Python + Flask** 的 **MySQL 数据库互导管理系统**，主要用于在源数据库与目标数据库之间进行数据迁移或同步，支持字段映射、默认值设置、分页导入、实时日志显示及“仅新增/覆盖”模式。适合企业内部数据库迁移、测试环境数据填充、大表迁移等场景。

---

## 2️⃣ 技术栈

| 层级     | 技术                     | 功能说明                   |
| ------ | ---------------------- | ---------------------- |
| 后端     | Python 3.12+           | 核心逻辑处理、数据库连接、分页导入、日志写入 |
| 后端框架   | Flask 3.0.3            | 提供 Web 服务接口、路由管理       |
| 数据库    | MySQL                  | 源数据库与目标数据库             |
| 数据库连接库 | mysql-connector-python | Python 与 MySQL 通信      |
| 前端     | HTML5 / CSS3 / JS      | 表单选择、字段映射、按钮操作         |
| 前端库    | Axios                  | AJAX 请求，实时获取字段、日志      |
| 静态资源   | JS                     | 前端逻辑处理（动态表格、日志轮询）      |

---

## 3️⃣ 功能模块

### 3.1 数据库配置

* 单独 `config.py` 文件管理源数据库和目标数据库配置：

  * host、port、user、password、database
* 支持分页导入设置（PAGE_SIZE）
* 日志文件位置 LOG_FILE

### 3.2 数据表选择

* 前端页面列出源数据库和目标数据库所有表
* 用户选择源表和目标表
* 点击按钮动态加载表字段

### 3.3 字段映射

* 前端生成字段映射表格：

  * 左侧：目标表字段
  * 右侧：源表字段下拉选择
  * 未匹配字段可填写默认值
* 支持手动映射，实现复杂字段对应

### 3.4 导入模式

* **覆盖模式（overwrite）**：使用 `REPLACE INTO`，源表数据覆盖目标表已有数据
* **仅新增模式（insert）**：使用 `INSERT IGNORE`，仅插入新记录，不删除已有数据

### 3.5 分页导入

* 支持大表分页导入，每页默认 100 条数据（可在 config.py 修改）
* 防止大表一次性导入造成内存压力

### 3.6 实时日志显示

* 导入过程中日志写入服务器 `import.log`
* 前端每秒轮询日志文件内容，实时显示进度
* 支持查看导入进度、报错信息、完成提示

### 3.7 异步处理

* 使用 Python `threading` 模块：

  * 导入任务在后台线程执行
  * 避免阻塞前端请求
* 用户点击“开始导入”后，立即返回前端界面

---

## 4️⃣ 页面结构

### 4.1 前端 index.html

* 下拉选择源表和目标表
* 字段映射表格（动态生成）
* 默认值输入框
* 导入模式选择（覆盖 / 仅新增）
* “开始导入”按钮
* 日志显示区

### 4.2 前端 JS

* 动态加载字段 (`/get_fields`)
* 记录字段映射和默认值
* AJAX 提交导入任务 (`/start_import`)
* 轮询日志显示 (`/get_log`)

---

## 5️⃣ 后端路由设计

| 路由              | 方法   | 功能              |
| --------------- | ---- | --------------- |
| `/`             | GET  | 首页，渲染表选择和字段映射页面 |
| `/get_fields`   | POST | 根据数据库和表名返回字段列表  |
| `/start_import` | POST | 启动后台导入任务（线程）    |
| `/get_log`      | GET  | 返回当前导入日志内容      |

---

## 6️⃣ 数据导入逻辑

1. 获取用户选择的源表、目标表、字段映射
2. 根据分页读取源表数据
3. 构造 SQL：

   * 覆盖模式：`REPLACE INTO target_table (...) VALUES (...)`
   * 仅新增模式：`INSERT IGNORE INTO target_table (...) VALUES (...)`
4. 执行 SQL 并提交事务
5. 每页导入完成写入日志
6. 导入完成写日志标记完成

---

## 7️⃣ 特点与优势

* **通用性强**：只需 Python 环境和 MySQL，即可部署
* **实时监控**：前端可实时查看导入日志和进度
* **灵活性高**：

  * 可手动字段映射
  * 可设置默认值
  * 可选择覆盖或仅新增模式
* **适合大数据量**：分页导入减少内存占用

---

## 8️⃣ 应用场景

* 测试环境快速导入生产数据样例
* 数据库迁移（同库或不同库）
* 数据清洗后导入
* 数据库备份恢复
* 小型 ETL 任务

---

## 9️⃣ 运行环境要求

* Python 3.10+
* Flask 3.0+
* MySQL 5.7+ / 8.0+
* mysql-connector-python
* 浏览器（支持现代 JS/AJAX）

---

## 10️⃣ 文件总结

| 文件                     | 功能                        |
| ---------------------- | ------------------------- |
| `config.py`            | 数据库配置及分页设置                |
| `app.py`               | Flask 后端主程序，处理字段、导入、日志    |
| `templates/index.html` | 前端界面，表选择、字段映射、日志显示        |
| `static/js/main.js`    | 前端 JS，AJAX 调用、日志轮询、字段映射管理 |

---


